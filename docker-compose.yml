services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: barofarm-frontend
    restart: unless-stopped

    # 서버(브리지) 모드: 호스트 백엔드에 host.docker.internal로 접근
    ports:
      - '3000:3000'
    extra_hosts:
      - 'host.docker.internal:host-gateway'

    environment:
      - NODE_ENV=production
      # 게이트웨이 주소
      - NEXT_PUBLIC_API_GATEWAY_URL=${NEXT_PUBLIC_API_GATEWAY_URL:-http://3.34.14.73:8080}
      - NEXT_PUBLIC_API_BASE_URL=${NEXT_PUBLIC_API_BASE_URL:-${NEXT_PUBLIC_API_GATEWAY_URL:-http://3.34.14.73:8080}}
      # 결제 클라이언트 키 (배포 환경 값으로 교체)
      - NEXT_PUBLIC_TOSS_CLIENT_KEY=${NEXT_PUBLIC_TOSS_CLIENT_KEY:-your-toss-client-key}
      # 이미지 URL (Nginx가 서빙)
      - NEXT_PUBLIC_IMAGE_BASE_URL=/uploads

    # ========================================
    # S3 마운트 없음 (최종 결정)
    # ========================================
    # 이유:
    #   1. 프론트엔드는 이미지 업로드를 하지 않음 (백엔드가 처리)
    #   2. 이미지 서빙은 Nginx가 호스트에서 직접 /mnt/mybucket 접근
    #   3. 보안: 프론트엔드는 S3에 접근할 필요 없음
    #   4. 성능: Nginx 직접 서빙이 가장 빠름
    #
    # 백엔드에서 업로드: uploadService.uploadFile() 사용
    # 이미지 서빙: Nginx → /mnt/mybucket/uploads/
    # ========================================
